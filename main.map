{"version":3,"file":"app-build/main.js","sources":["app/main.js","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/8"],"names":[],"mappings":"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","sourceRoot":"app-build/","sourcesContent":["\n//var traceur = require(\"traceur\");\n//\n// console.log(\"traceur\",traceur);\n//\n// return;\n\n// require('nodetime').profile({\n//     accountKey: 'f6554c48283af492abfcd07d5ad45f584e1fa3e5',\n//     appName: 'GenMusic'\n//   });\n\n// var console = require('better-console');\n\n\n// throw \"bye\";\n\n\nimport \"./patchConsoleLog\";\n\nvar teoria = require(\"teoria\");\n\nimport {m} from \"./functionalMonads\";\n\nimport {t} from \"./time\";\n\nimport {wu} from \"./wu\";\n\n\nimport {abletonReceiver, abletonSender} from \"./oscAbleton\";\n\nimport {isIterable,getIterator,clone} from \"./utils\";\n\nimport * as moduleManager from \"./generatorModuleManager\";\n\nvar _ = require(\"lodash\");\n\n\n\nvar Bacon = require(\"baconjs\");\n\n\n\n// console.log('hello'.green);\n\n\n//\n// var kick=m.evt({pitch:60,duration:(1/4), velocity:100}).loop().metro((1)).notePlay();\n//\n// var shaker=m.evt().set({pitch:60,duration:(1/12)}).loop()\n// .pitch([40,41,39,41,43,39,40,39]).velocity([70,20,50,4,60,40,50,30])\n// //.repeat(8)\n//\n//  .metro((1/4))\n// //.map((n)=> n)\n//  .swing((0.25),0.1)\n//  // .velocity((v) => v.time % t.bars(4) > (0.3) ? v.velocity : 0)\n//  // .velocity((v) => v.time % t.bars(8) < t.bars(7.5) ? v.velocity : 10)\n//  // .velocity((v) => _.contains([0,1,2,4,5,7],Math.floor((v.time % (2))/(0.25))) ? v.velocity : 0)\n// // .delay((1/2))\n//\n// .notePlay();\n//\n// var shaker2=m.evt({ duration:(0.1)}).loop().metro((0.25)).bjorklund(4,3,3).pitch([37,37,38]).velocity([0.5,0.7,0.6,0.5,0.6]).swing(0.25,0.1)\n// .combineMap((k,me) => {\n//\n//     return (k.next.time == me.time) ? {velocity: 0.3, time: (n) => n.time-0.05} : me;\n// },\n// kick)\n// .notePlay();\n//\n// console.time();\n// for (let e of shaker.take(10000))\n// //  console.log(e);\n// ;\n// //for (let e of shaker2.take(2000));\n//\n// console.timeEnd();\n//\n// return;\n\n\n\n\n// var seqTest2 = m.evt({name:\"baconTest\",duration:10}).loop().metro(60);\n// BaconSequencer(abletonReceiver.time,seqTest2).log(\"seqTest\");\n\nvar traceur = require(\"traceur\");\n\n\nvar liveCodeReset = new Bacon.Bus();\n\nvar lastCodeResetNo = -1;\n\n\nvar decodedTime = abletonReceiver.time.diff(0,(a,b) => b-a).skip(1).zip(abletonReceiver.time.skip(1),(timeDiff,time) => {return {timeDiff,time}})\n  .map((time) => time.timeDiff < -8 ? _.extend({reset:true},time) : time)\n  .combine(liveCodeReset.debounceImmediate(500).toProperty(),\n    function(time, codeReset) {\n      if (lastCodeResetNo != codeReset) {\n        console.log(\"RESET\",time,codeReset);\n        lastCodeResetNo = codeReset;\n        return _.extend({reset:true},time);\n      }\n      return time;\n    }\n  )\n  .scan({},(prev,time) => {\n    var newTime = _.clone(time);\n    if (prev.firstTime > 0 && !time.reset)\n      newTime.firstTime = prev.firstTime;\n    else\n      newTime.firstTime = time.time-time.time % t.bars(4);\n    return newTime;\n  });\n\n\n\n\n// TODO: could move all this time stuff to sequencePlayManager or another module\n// TODO: timeThatAccountsForTransportJumps should be a stream of functions that can convert time to global ableton time automatically\n// TODO: make every stream have its own starttime\nvar timeThatAccountsForTransportJumps2 = decodedTime.map((t) => {return {time: t.time-t.firstTime, offset: t.firstTime}});\n\n\nvar timeThatAccountsForTransportJumps = timeThatAccountsForTransportJumps2;\n\nvar resetMessages = decodedTime.map((t) => t.reset).filter((t) => t).debounce(50);\n\n\ntimeThatAccountsForTransportJumps.throttle(1000).log(\"timeWithOffset\");\n\nresetMessages.log(\"RESET\");\n\n//timeThatAccountsForTransportJumps.log(\"time\");\n\n//var OSCSequencer = TomFRPSequencer(timeThatAccountsForTransportJumps);\n\n//decodedTime.log(\"decodedTime\");\n\n\n\nimport webServer from \"./webConnection\";\n\n\nimport SequencePlayManager from \"./sequencePlayManager\";\n\nvar sequencePlayManager = SequencePlayManager(timeThatAccountsForTransportJumps.toEventStream(),resetMessages, webServer.sequenceFeedback);\n\nliveCodeReset.plug(sequencePlayManager.resetRequests);\n\n\nimport {baconStorer, onCodeLoaded, storedSequences} from \"./codeStore\";\n\n\n\n\n// console.log(new TWEEN.Tween({a:2}));\n// throw \"hey\";\n\nvar Easer = require('functional-easing').Easer;\n\n\n\n\n\n\n\n\n\n//timeThatAccountsForTransportJumps.toEventStream().skipDuplicates().log(\"beat\");\nwebServer.beatFeedback(timeThatAccountsForTransportJumps.toEventStream().map((t) => Math.floor(t.time)).skipDuplicates());\n\n\n\nvar newClipSequences = abletonReceiver.clipNotes.map(function(v) {\n  var notes = _.sortBy(v.notes, (n) => n.time);\n  var seq=m.data(notes.map((n) => {\n    return {\n      pitch: n.pitch,\n      duration: n.duration,\n      velocity:n.velocity/127,\n      time: n.time,\n      color: \"yellow\"\n    }\n  }\n)).loopLength(v.loopEnd-v.loopStart);\n  //console.log(\"clipSeq\",seq.pitch);\n  console.log(\"created clip seq from clipNotes\",{device:\"abletonClip\", name: v.name});\n\n  var code = \"export var \"+v.name+\" = \"+seq.toString()+\";\"\n  return {device:\"abletonClip_\"+v.name, code: code};\n});\n\nmoduleManager.newSequenceCode.plug(newClipSequences);\n\nmoduleManager.newSequenceCode.plug(webServer.liveCode);\n\nsetTimeout(function() {\n  console.log(\"CODE LOADED\",storedSequences);\n  for (var seq of storedSequences) {\n    moduleManager.newSequenceCode.push({device: seq.device, code: seq.code});\n  }\n  moduleManager.loadedSequences.onValue(v =>console.log(\"after load:\",v.toJS()));\n}, 1000);\n\n// var clipAndCodeSequences = new Bacon.Bus();\n\n// clipAndCodeSequences.plug(compiledSequencesFromWeb);\n// clipAndCodeSequences.plug(newClipSequences);\n\n\n\n\nsequencePlayManager.newSequence.plug(moduleManager.processedSequences);\n\n// var resetNo=0;\n// clipAndCodeSequences.onValue(() => liveCodeReset.push(resetNo++));\n\nvar Immutable = require(\"immutable\");\n\nvar generatorList = moduleManager.processedSequences\n  .scan({},(prev,next) => {\n    console.log(\"generating first 500 samples of sequence\",next);\n    prev[next.name] = {\n      device:next.device,\n      name: next.name,\n      sourceCode:\n      next.code,\n      sequenceAsString: next.sequence.toString(),\n      eventSample: next.sequence.toPlayable().take(500).takeWhile((n) => n.time < 8).toArray()\n    };\n    // console.log(\"generated\", prev);\n    return prev;\n  })\n  .map(_.values)\n  .debounce(300);\n\nbaconStorer.plug(moduleManager.processedSequences);\n\ngeneratorList.onValue((v) => {\n  // console.log(\"genList\",v);\n  webServer.generatorUpdate(v);\n  abletonSender.generatorUpdate(v);\n});\n","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","\n        for (var $__placeholder__0 =\n                 $__placeholder__1[\n                     $traceurRuntime.toProperty(Symbol.iterator)](),\n                 $__placeholder__2;\n             !($__placeholder__3 = $__placeholder__4.next()).done; ) {\n          $__placeholder__5;\n          $__placeholder__6;\n        }"]}