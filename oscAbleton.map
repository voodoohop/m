{"version":3,"file":"app-build/oscAbleton.js","sources":["app/oscAbleton.js","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/7"],"names":[],"mappings":"AAAA;ACAA,KAAK,iBAAiB,AAAC,CAAC,OAAM;eCA9B,EAAC,GAAE,YCAqB;AAAE,0BAAwB;IAAE,ADA9B,CAAC;iBAAvB,EAAC,GAAE,YCAqB;AAAE,4BAAwB;IAAE,ADA9B,CAAC;AEAvB,WAAS,CCAT,EAAC,KAAI,CDAO,KAAG,ACAS,CAAC;CJAyB,CAAC;;;;EDA3C,EAAA,EMAR,EAAC,WAAoB,CAAA,OAAM,AAAC,UAAkB,CACtC,CAAA,YAAqB,qBAA2B,CAAA,YAAqB,GAAK,EAAC,OAAM,WAAmB,CAD9D,AAC+D,CAAC;ENCvG,iBAAe,EMFtB,EAAC,uBAAoB,CAAA,OAAM,AAAC,sBAAkB,CACtC,CAAA,wBAAqB,iCAA2B,CAAA,wBAAqB,GAAK,EAAC,OAAM,uBAAmB,CAD9D,AAC+D,CAAC;ENGtG,GAAC,EMJT,EAAC,SAAoB,CAAA,OAAM,AAAC,QAAkB,CACtC,CAAA,UAAqB,mBAA2B,CAAA,UAAqB,GAAK,EAAC,OAAM,SAAmB,CAD9D,AAC+D,CAAC;ANK9G,AAAI,EAAA,CAAA,GAAE,EAAI,CAAA,OAAM,AAAC,CAAC,KAAI,CAAC,CAAC;AAExB,AAAI,EAAA,CAAA,KAAI,EAAI,CAAA,OAAM,AAAC,CAAC,SAAQ,CAAC,CAAC;AAE9B,AAAI,EAAA,CAAA,gBAAe,EAAI,UAAS,OAAM;AAEpC,OAAO,CAAA,KAAI,WAAW,AAAC,CAAC,SAAS,IAAG;AAClC,UAAM,GAAG,AAAC,CAAC,SAAQ,GAAG,SAAC,CAAA;WAAM,CAAA,IAAG,AAAC,CAAC,CAAA,CAAC;IAAA,EAAC,CAAC;AACrC,SAAO,UAAQ,AAAC,CAAC;AAAC,YAAM,IAAI,AAAC,CAAC,kBAAiB,CAAC,CAAA;IAAC,CAAC;EACpD,CAAC,CAAC;AAEJ,CAAA;AAEA,AAAI,EAAA,CAAA,cAAa,EAAI,UAAS,OAAM,CAAE,CAAA,OAAM,CAAE,CAAA,UAAS,CAAG,CAAA,UAAS;AACjE,AAAI,IAAA,CAAA,MAAK,EAAI,CAAA,UAAS,OAAO,CAAC;AAC9B,AAAI,IAAA,CAAA,OAAM,EAAI,CAAA,UAAS,QAAQ,CAAC;AAChC,AAAI,IAAA,CAAA,SAAQ,EAAI,GAAC,CAAC;AAClB,WAAS,KAAK,AAAC,CAAC,CAAA,CAAC,QAAQ,AAAC,EAAE,SAAA,AAAC;AOtBvB,QAAS,GAAA,OACA,CPqBkC,MAAK,KAAK,AAAC,CAAC,SAAQ,CAAC,COpBnD,eAAc,WAAW,AAAC,CAAC,MAAK,SAAS,CAAC,CAAC,AAAC,EAAC;AACjD,WAAgB,CACpB,EAAC,CAAC,MAAoB,CAAA,SAAqB,AAAC,EAAC,CAAC,KAAK,GAAK;QPkBvB,EAAA;AAA6B,eAAS,QAAQ,AAAC,CAAC,OAAM,CAAE,QAAM,CAAE,EAAA,CAAC,CAAC;IOfxG;AAAA,APeyG,YAAQ,EAAI,GAAC,CAAC;EAAC,EAAC,CAAA;AAC/H,OAAO;AACL,SAAK,CAAG,CAAA,EAAC,UAAU,AAAC,CAAC,SAAS,KAAI,CAAE,CAAA,QAAO,CAAE,CAAA,IAAG,CAAG;AACjD,cAAQ,CAAE,KAAI,CAAC,EAAI,KAAG,CAAC;AACvB,WAAO,CAAA,UAAS,OAAO,AAAC,CAAC,OAAM,CAAE,QAAM,CAAE,MAAI,CAAE,SAAO,CAAE,KAAG,CAAC,CAAC;IAC/D,CAAC;AACD,UAAM,CAAG,CAAA,EAAC,UAAU,AAAC,CAAC,SAAS,KAAI,CAAE,CAAA,IAAG,CAAG;AACzC,WAAO,UAAQ,CAAE,KAAI,CAAC,CAAC;AACvB,WAAO,CAAA,UAAS,QAAQ,AAAC,CAAC,OAAM,CAAE,QAAM,CAAE,MAAI,CAAE,KAAG,CAAC,CAAC;IACvD,CAAC;AACD,QAAI,CAAG,CAAA,UAAS,MAAM;AAAA,EACxB,CAAA;AAEF,CAAC;AAGD,AAAI,EAAA,CAAA,eAAc,EAAI,UAAS,MAAK;AAElC,AAAI,IAAA,CAAA,SAAQ,EAAI,IAAI,CAAA,KAAI,IAAI,AAAC,EAAC,CAAC;AAE/B,AAAI,IAAA,CAAA,OAAM,EAAI,IAAI,CAAA,GAAE,QAAQ,AAAC,CAAC;AAC1B,eAAW,CAAG,YAAU;AACxB,YAAQ,CAAG,OAAK;AAAA,EACpB,CAAC,CAAC;AAEF,QAAM,KAAK,AAAC,EAAC,CAAC;AAKd,QAAM,IAAI,AAAC,CAAC,uCAAsC,CAAE,OAAK,CAAC,CAAC;AAE3D,AAAI,IAAA,CAAA,YAAW,EAAI,CAAA,gBAAe,AAAC,CAAC,OAAM,CAAC,CAAC;AAE5C,AAAI,IAAA,CAAA,UAAS,EAAI,CAAA,YAAW,OAAO,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,OAAM,QAAQ,GAAK,cAAY;EAAA,EAAC,IAAI,AAAC,EAAC,SAAC,SAAQ;SAAM,CAAA,SAAQ,KAAK,CAAE,CAAA,CAAC;EAAA,EAAC,CAAC;AAGzH,aAAW,OAAO,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,OAAM,QAAQ,GAAK,eAAa;EAAA,EAAC,IAAI,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,OAAM,KAAK,CAAE,CAAA,CAAC;EAAA,EAAC,eAAe,AAAC,EAAC,QAAQ,AAAC,CAAC,SAAS,CAAA,CAAE;AACxI,YAAQ,KAAK,AAAC,CAAC,CAAA,CAAC,CAAC;EACnB,CAAC,CAAC;AAEF,AAAI,IAAA,CAAA,QAAO,EAAI,CAAA,OAAM,AAAC,CAAC,WAAU,CAAC,CAAC;AACnC,AAAI,IAAA,CAAA,SAAQ,EAAI,CAAA,YAAW,OAAO,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,OAAM,QAAQ,GAAK,oBAAkB;EAAA,EAAC,IAAI,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,IAAG,MAAM,AAAC,CAAC,QAAO,qBAAqB,AAAC,CAAC,OAAM,KAAK,CAAE,CAAA,CAAC,CAAC,CAAC;EAAA,EAAC,CAAC;AACrK,UAAQ,IAAI,AAAC,CAAC,cAAa,CAAC,CAAC;AAO7B,AAAI,IAAA,CAAA,oBAAmB,EAAI,CAAA,YAAW,OAAO,AAAC,EAAC,SAAC,OAAM;SAAM,CAAA,OAAM,QAAQ,GAAK,mBAAiB;EAAA,EAAC,IAC5F,AAAC,EAAC,SAAC,CAAA,CAAM;AAAC,SAAO;AAAC,iBAAW,CAAG,CAAA,CAAA,KAAK,CAAE,CAAA,CAAC;AAAG,SAAG,CAAG,CAAA,CAAA,KAAK,CAAE,CAAA,CAAC;AAAA,IAAC,CAAA;EAAC,EAAC,CAAA;AAGjE,AAAI,IAAA,CAAA,UAAS,IAAI,SAAC,IAAG;SAAM,CAAA,YAAW,OAC9B,AAAC,EAAC,SAAC,OAAM;WAAM,CAAA,OAAM,QAAQ,WAAW,AAAC,CAAC,SAAQ,EAAE,KAAG,CAAC;IAAA,EAAC,IAC5D,AAAC,EAAC,SAAC,OAAM;WAAM,CAAA,OAAM,KAAK,CAAE,CAAA,CAAC;IAAA,EAAC,WAAW,AAAC,EAAC;EAAA,CAAA,CAAC;AAGjD,WAAS,AAAC,CAAC,GAAE,CAAC,QAAQ,AAAC,EAAC,SAAC,CAAA;SAAM,CAAA,OAAM,IAAI,AAAC,CAAC,YAAW,CAAE,EAAA,CAAC;EAAA,EAAC,CAAC;AAG7D,AAAI,IAAA,CAAA,WAAU,EAAI,CAAA,SAAQ,IAAI,AAAC,EAAC,SAAC,IAAG;SAAM,CAAA,IAAG,EAAE,CAAA,CAAA,MAAM,AAAC,CAAC,CAAA,CAAC;EAAA,EAAC,CAAC;AAExD,OAAO;AACL,OAAG,CAAG,YAAU;AAChB,QAAI,CAAI,WAAS;AACjB,aAAS,CAAG,WAAS;AACrB,YAAQ,CAAE,UAAQ;AAClB,uBAAmB,CAAG,qBAAmB;AAAA,EAC3C,CAAA;AAEF,CAAA;AAGA,AAAI,EAAA,CAAA,aAAY,EAAI,UAAS,OAAM;AACjC,AAAI,IAAA,CAAA,OAAM,EAAI,IAAI,CAAA,GAAE,QAAQ,AAAC,CAAC;AAC1B,eAAW,CAAG,UAAQ;AACtB,YAAQ,CAAG,MAAI;AAAA,EACnB,CAAC,CAAC;AAEF,QAAM,IAAI,AAAC,CAAC,qCAAoC,CAAE,QAAM,CAAC,CAAC;AAK1D,QAAM,KAAK,AAAC,EAAC,CAAC;AAUd,AAAI,IAAA,CAAA,MAAK,EAAI,CAAA,EAAC,UAAU,AAAC,CAAC,SAAS,OAAM,CAAE,CAAA,OAAM,CAAE,CAAA,KAAI,CAAE,CAAA,QAAO,CAAE,CAAA,IAAG,CAAG;AAEtE,UAAM,KAAK,AAAC,CAAC;AACT,YAAM,CAAG,YAAU;AACnB,SAAG,CAAG,EAAC,OAAM,CAAG,MAAI,CAAG,CAAA,IAAG,MAAM,AAAC,CAAC,QAAO,EAAE,IAAE,CAAC,CAAG,EAAA,CAAE,CAAA,IAAG,EAAE,CAAA,CAAA,MAAM,AAAC,CAAC,CAAA,CAAC,CAAC;AAAA,IACtE,CAAG,YAAU,CAAG,QAAM,CAAC,CAAC;EAK1B,CAAC,CAAC;AAGF,AAAI,IAAA,CAAA,OAAM,EAAI,CAAA,EAAC,UAAU,AAAC,CAAC,SAAS,OAAM,CAAE,CAAA,OAAM,CAAE,CAAA,KAAI,CAAE,CAAA,IAAG,CAAG;AAG9D,UAAM,KAAK,AAAC,CAAC;AACX,YAAM,CAAG,YAAU;AACnB,SAAG,CAAG,EAAC,OAAM,CAAE,MAAI,CAAG,EAAA,CAAG,EAAA,CAAE,CAAA,IAAG,EAAE,CAAA,CAAA,MAAM,AAAC,CAAC,CAAA,CAAC,CAAC;AAAA,IAC5C,CAAG,YAAU,CAAG,QAAM,CAAC,CAAC;EAC1B,CAAC,CAAC;AAEF,AAAI,IAAA,CAAA,KAAI,EAAE,CAAA,EAAC,UAAU,AAAC,CAAC,SAAS,OAAM,CAAE,CAAA,OAAM,CAAE,CAAA,IAAG,CAAE,CAAA,GAAE,CAAE,CAAA,IAAG,CAAG;AAE7D,UAAM,KAAK,AAAC,CAAC;AACX,YAAM,CAAG,SAAO;AAChB,SAAG,CAAE,EAAC,OAAM,CAAE,KAAG,CAAG,CAAA,IAAG,GAAI,YAAU,CAAA,CAAI,CAAA,IAAG,MAAM,AAAC,CAAC,GAAE,EAAE,IAAE,CAAC,CAAA,CAAG,IAAE,CAAE,CAAA,IAAG,EAAE,CAAA,CAAA,MAAM,AAAC,CAAC,CAAA,CAAC,CAAC;AAAA,IACnF,CAAE,YAAU,CAAG,QAAM,CAAC,CAAC;EACzB,CAAC,CAAC;AAEF,AAAI,IAAA,CAAA,kBAAiB,EAAI,IAAI,CAAA,KAAI,IAAI,AAAC,EAAC,CAAC;AAExC,mBAAiB,QAAQ,AAAC,EAAC,SAAC,CAAA,CAAM,GAElC,EAAC,CAAC;AAIF,AAAI,IAAA,CAAA,eAAc,EAAE,UAAS,aAAY;AACvC,UAAM,IAAI,AAAC,CAAC,oCAAmC,KAAK,CAAG,CAAA,CAAC,aAAY,IAAI,AAAC,EAAC,SAAA,CAAA;WAAK,CAAA,CAAA,OAAO,EAAE,IAAE,CAAA,CAAE,CAAA,CAAA,KAAK;IAAA,EAAC,CAAC,OAAO,CAAC,CAAC;AAC5G,UAAM,KAAK,AAAC,CAAC;AACX,YAAM,CAAE,iBAAe;AACvB,SAAG,CAAG,CAAA,aAAY,IAAI,AAAC,EAAC,SAAA,CAAA;aAAK,CAAA,CAAA,KAAK;MAAA,EAAC;AAAA,IACrC,CAAG,YAAU,CAAG,QAAM,CAAC,CAAC;EAC1B,CAAC;AAED,OAAO;AACL,aAAS,CAAG,UAAS,OAAM,CAAG;AAC5B,WAAO;AACL,aAAK,CAAG,CAAA,MAAK,AAAC,CAAC,OAAM,CAAE,QAAM,CAAC;AAC9B,cAAM,CAAG,CAAA,OAAM,AAAC,CAAC,OAAM,CAAE,QAAM,CAAC;AAChC,YAAI,CAAG,CAAA,KAAI,AAAC,CAAC,OAAM,CAAE,QAAM,CAAC;AAAA,MAC9B,CAAA;IACF;AACA,sBAAkB,CAAG,UAAS,OAAM,CAAG,CAAA,YAAW,CAAG;AACnD,WAAO;AACL,aAAK,CAAG,CAAA,MAAK,AAAC,CAAC,OAAM,CAAE,aAAW,CAAC;AACnC,cAAM,CAAG,CAAA,OAAM,AAAC,CAAC,OAAM,CAAE,aAAW,CAAC;AACrC,YAAI,CAAG,CAAA,KAAI,AAAC,CAAC,OAAM,CAAE,aAAW,CAAC;AAAA,MACnC,CAAA;IACF;AACA,SAAK,CAAG,OAAK;AACb,UAAM,CAAG,QAAM;AACf,QAAI,CAAE,MAAI;AACV,kBAAc,CAAE,gBAAc;AAAA,EAKhC,CAAA;AACF,CAAA;AAGO,AAAI,EAAA,CAAA,aAAY,EAAI,CAAA,aAAY,AAAC,CAAC,IAAG,CAAC,CAAC;AACvC,AAAI,EAAA,CAAA,eAAc,EAAI,CAAA,eAAc,AAAC,CAAC,IAAG,CAAC,CAAC;AAClD","sourceRoot":"app-build/","sourcesContent":["import {t} from \"./time\";\n\nimport timeInterpolator from \"./timeInterpolator\";\n\nimport {wu} from \"./wu\";\n\nvar osc = require(\"osc\");\n\nvar Bacon = require(\"baconjs\");\n\nvar oscToBaconStream = function(udpPort) {\n\n  return Bacon.fromBinder(function(sink) {\n    udpPort.on(\"message\", (m) => sink(m));\n    return function(){console.log(\"baconunsubscribe\")};\n  });\n\n}\n\nvar noteOffTracker = function(seqName,outPort,baconReset, notePlayer) {\n  var noteOn = notePlayer.noteOn;\n  var noteOff = notePlayer.noteOff;\n  var currentOn = {};\n  baconReset.take(1).onValue( () => {for (let n of Object.keys(currentOn)) notePlayer.noteOff(seqName,outPort,n);currentOn = {};})\n  return {\n    noteOn: wu.curryable(function(pitch,velocity,time) {\n      currentOn[pitch] = true;\n      return notePlayer.noteOn(seqName,outPort,pitch,velocity,time);\n    }),\n    noteOff: wu.curryable(function(pitch,time) {\n      delete currentOn[pitch];\n      return notePlayer.noteOff(seqName,outPort,pitch,time);\n    }),\n    param: notePlayer.param\n  }\n\n};\n\n\nvar AbletonReceiver = function(inPort) {\n\n  var baconTime = new Bacon.Bus();\n\n  var udpPort = new osc.UDPPort({\n      localAddress: \"127.0.0.1\",\n      localPort: inPort\n  });\n\n  udpPort.open();\n\n\n  //udpPort.on(\"message\", (m) => console.log(m));\n\n  console.log(\"starting OSC Ableton receiver on port\",inPort);\n\n  var oscMessageIn = oscToBaconStream(udpPort);\n\n  var codeChange = oscMessageIn.filter((message) => message.address == \"/codeChange\").map((oscBundle) => oscBundle.args[0]);\n\n\n  oscMessageIn.filter((message) => message.address == \"/abletonTime\").map((message) => message.args[0]).skipDuplicates().onValue(function(v){\n    baconTime.push(v);\n  });\n\n  var lzString = require(\"lz-string\");\n  var clipNotes = oscMessageIn.filter((message) => message.address == \"/abletonClipNotes\").map((message) => JSON.parse(lzString.decompressFromBase64(message.args[0])));\n  clipNotes.log(\"oscClipNotes\");\n  // oscMessageIn.onValue(function(v) {\n  //   console.log(\"osc\",v);\n  // });\n  //oscMessageIn.log(\"osc\");\n\n  // TODO: use scan instead of onValue\n  var sequencePlayRequests = oscMessageIn.filter((message) => message.address == \"/requestSequence\")\n    .map((v) => {return {sequenceName: v.args[0], port: v.args[1]}})\n\n\n  var baconParam = (name) => oscMessageIn\n    .filter((message) => message.address.startsWith(\"/param/\"+name))\n    .map((message) => message.args[0]).toProperty();\n\n\n  baconParam(\"1\").onValue((v) => console.log(\"baconvalue\",v));\n\n//  var timeInBeats = timeInterpolator(baconTime.map((time) => time/t.beats(1)));\nvar timeInBeats = baconTime.map((time) => time/t.beats(1));\n\n  return {\n    time: timeInBeats,\n    param:  baconParam,\n    codeChange: codeChange,\n    clipNotes:clipNotes,\n    sequencePlayRequests: sequencePlayRequests,\n  }\n\n}\n\n\nvar AbletonSender = function(outPort) {\n  var udpPort = new osc.UDPPort({\n      localAddress: \"0.0.0.0\",\n      localPort: 55555\n  });\n\n  console.log(\"starting OSC Ableton sender to port\",outPort);\n\n\n  // Open the socket.\n\n  udpPort.open();\n  // Send an OSC message to, say, SuperCollider\n\n\n  // var play = wu.curryable(function(seqName, baconTime, evt) {\n  //   if (evt.continuousPlay) {\n  //\n  //   }\n  // });\n\n  var noteOn = wu.curryable(function(seqName,outPort,pitch,velocity,time) {\n    // console.log(\"noteOn\",pitch,time*t.beats(1));\n    udpPort.send({\n        address: \"/midiNote\",\n        args: [seqName, pitch, Math.floor(velocity*127), 1,time*t.beats(1)]\n    }, \"127.0.0.1\", outPort);\n    // udpPort.send({\n    //   address: \"/codeUpdate\",\n    //   args: [\"while(true) {console.log(\\'hlo\\');\\n}\"+Math.random()],\n    // },\"127.0.0.1\", outPort);\n  });\n\n\n  var noteOff = wu.curryable(function(seqName,outPort,pitch,time) {\n  //console.log(\"noteOff\",pitch,time*t.beats(1));\n\n    udpPort.send({\n      address: \"/midiNote\",\n      args: [seqName,pitch, 0, 0,time*t.beats(1)]\n    }, \"127.0.0.1\", outPort);\n  });\n\n  var param=wu.curryable(function(seqName,outPort,name,val,time) {\n    // console.log(\"automation\",seqName,name,val,outPort);\n    udpPort.send({\n      address: \"/param\",\n      args:[seqName,name, name== \"pitchBend\" ? Math.floor(val*127) :val,time*t.beats(1)]\n    },\"127.0.0.1\", outPort);\n  });\n\n  var baconInstrumentBus = new Bacon.Bus();\n\n  baconInstrumentBus.onValue((v) => {\n\n  });\n\n  // var diffTime = null;\n\n  var generatorUpdate=function(generatorList) {\n    console.log(\"sending generatorUpdate to Ableton\".bold, (generatorList.map(g => g.device+\"/\"+g.name)).yellow);\n    udpPort.send({\n      address:\"/generatorList\",\n      args: generatorList.map(g => g.name)\n    }, \"127.0.0.1\", outPort);\n  };\n\n  return {\n    instrument: function(seqName) {\n      return {\n        noteOn: noteOn(seqName,outPort),\n        noteOff: noteOff(seqName,outPort),\n        param: param(seqName,outPort)\n      }\n    },\n    subscribeInstrument: function(seqName, listenerPort) {\n      return {\n        noteOn: noteOn(seqName,listenerPort),\n        noteOff: noteOff(seqName,listenerPort),\n        param: param(seqName,listenerPort)\n      }\n    },\n    noteOn: noteOn,\n    noteOff: noteOff,\n    param:param,\n    generatorUpdate:generatorUpdate,\n    // usedTime: function(baconTime) {\n    //   diffTime = baconTime;\n    // }\n\n  }\n}\n\n\nexport var abletonSender = AbletonSender(8916);\nexport var abletonReceiver = AbletonReceiver(8895);\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","\n        for (var $__placeholder__0 =\n                 $__placeholder__1[\n                     $traceurRuntime.toProperty(Symbol.iterator)](),\n                 $__placeholder__2;\n             !($__placeholder__3 = $__placeholder__4.next()).done; ) {\n          $__placeholder__5;\n          $__placeholder__6;\n        }"]}