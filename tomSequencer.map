{"version":3,"file":"app-build/tomSequencer.js","sources":["app/tomSequencer.js","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/6"],"names":[],"mappings":"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","sourceRoot":"app-build/","sourcesContent":["\nimport {wu} from \"./wu\";\nimport {getIterator} from \"./utils\";\nimport {t} from \"./time\";\n\nvar Bacon = require(\"baconjs\");\n\n// var Rx = require(\"Rx\");\n\nvar eventPlayer = function(evtWithOffset) {\n//  console.log(\"trying to play\", evt);\n  var evt = evtWithOffset.evt;\n  var firstTime = evtWithOffset.firstTime.offset;\n  // console.log(evtWithOffset)\n  return {evt: evt, play: function(instrument) {\n   if (evt.type==\"noteOn\") {\n    instrument.noteOn(evt.pitch.valueOf(), evt.velocity.valueOf(), evt.time+firstTime);\n   }\n   if (evt.type==\"noteOff\") {\n     instrument.noteOff(evt.pitch.valueOf(), evt.time+firstTime);\n    }\n    if (evt.type==\"automation\") {\n      instrument.param(evt.name, evt.automationVal, evt.time+firstTime);\n    }\n  }};\n}\n\nexport var BaconSequencer = wu.curryable(function(baconTime, sequence) {\n  console.log(\"sequencer\",sequence);\n  var seqIterator = null;\n  var next=null;\n  return baconTime.take(1).flatMap((firstTime) => baconTime.diff(firstTime,(prevDecoded,timeDecoded) => {\n\n    // TODO: do backwards time jump here\n    var prevTime = prevDecoded.time;\n    if (Number.isNaN(prevTime))\n      prevTime = 0;\n    var time = timeDecoded.time;\n\n    if (seqIterator == null) {\n      console.log(\"skipping to\",prevTime,\"for sequence\",sequence);\n      seqIterator = getIterator(sequence\n        .skipWhile((n) => n.time < prevTime)\n        .toPlayable());\n      next = seqIterator.next();\n    //   console.log(\"Rx\",Rx.Observable);\n    //   var seqStream = Rx.Observable.from(sequence.skipWhile((n) => n.time < prevTime)\n    //   .toPlayable());\n    //   console.log(\"rxStream\",seqStream);\n    //   var subscription = seqStream.subscribe(\n    //     function (x) {\n    //       console.log('Next: ' + x);\n    //     },\n    //     function (err) {\n    //       console.log('Error: ' + err);\n    //     },\n    //     function () {\n    //       console.log('Completed');\n    //     });\n    //\n    //   console.log(\"done skipping\");\n    }\n\n    // console.log(\"timeDecoded\", timeDecoded);\n    var count=0;\n    while (next.value.time < prevTime) {\n      next = seqIterator.next();\n      console.warn(\"time lag:\",prevTime-next.value.time+\"\".bgRed, next.value);\n      if (count++ > 5) { // low limit for too many events may need to change for other environments!!!\n         console.log(\"event overflow, yielding to bacon\",time.toFixed(2));\n         return [];\n      }\n    }\n    if (time-prevTime > 1)\n      return [];\n    var eventsNow = [];\n    while (next.value.time <= time) {\n      eventsNow.push({evt: next.value, firstTime:firstTime});\n      next = seqIterator.next();\n      if (count++ > 5)\n        return eventsNow;\n    }\n\n    //console.log(eventsNow.length);\n    return eventsNow;\n  })).flatMap((v) => Bacon.fromArray(v))\n  .map(eventPlayer);\n});\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})"]}