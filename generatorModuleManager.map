{"version":3,"file":"app-build/generatorModuleManager.js","sources":["app/generatorModuleManager.js","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/8","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/7","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/5"],"names":[],"mappings":"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","sourceRoot":"app-build/","sourcesContent":["// var console = require('better-console');\n\nvar Bacon = require(\"baconjs\");\n\nvar Immutable = require(\"immutable\");\n\n\n\nimport {isIterable,getIterator,clone} from \"./lib/utils\";\n\n\n\n\nimport evalSequences from \"./sequenceEvaluator\";\n\nvar _ = require(\"lodash\");\n\n\nexport var newSequenceCode = new Bacon.Bus();\n\n// export var loadedSequences = Immutable.Map();\n\n\n\n\nvar fs = require(\"fs\"),\n    mkpath = require(\"mkpath\");\n\nimport processCode from \"./sequenceCodeProcessor\";\n\nvar processed=newSequenceCode.map(processCode);\n\nprocessed.onError(e => console.error(\"Error while processing code\",e));\n\nvar loadedSequenceStream = new Bacon.Bus();\n\n\nvar evalStreamEntry = function(loadedSequences, newSequence) {\n  console.log(\"evaluating new Sequence:\".underline,newSequence);\n  var newSeqIm = Immutable.fromJS(newSequence);\n  if (newSeqIm.get(\"error\"))\n    return newSeqIm;\n  var allExports = loadedSequences.valueSeq().map(v => v.get(\"exports\")).flatten();\n  var unsatisfiedImports = newSeqIm.get(\"imports\").entrySeq().filter((i) => {\n    var [importDevice, importSeqNames] = i;\n    // if (loadedSequences.get(importDevice))\n    //   console.log(\"importdevice\",loadedSequences.get(importDevice).toJS(),\"imSeqNames\",importSeqNames.toJS());\n    return !loadedSequences.get(importDevice) || !importSeqNames.isSubset(loadedSequences.get(importDevice).get(\"exports\"))\n  }\n  );\n  if (unsatisfiedImports.count() > 0) {\n    console.log(\"imports unSatisfied\".red, unsatisfiedImports.toJS());\n    // console.log(\"all imports\",newSeqIm.get(\"imports\").entrySeq().toJS());\n    console.log(\"existing exports\".bold,loadedSequences.entrySeq().map(s => ({name: s[0],  exports:s[1].get(\"exports\").toJS()})).toJS());\n    return newSeqIm.set(\"evaluatedError\", Immutable.Map({type:\"importsUnsatisfied\", msg:\"imports unsatisfied\", imports:unsatisfiedImports}));\n  }\n  var [evaluated,details, error] = evalSequences(newSequence, loadedSequences);\n  var evaluatedRes = null;\n  if (!details) {\n    console.error(\"eval of \",newSequence,\"FAILED!!!\".red);\n    //return Bacon.never();\n    evaluatedRes = Immutable.fromJS(newSequence).set(\"evaluatedError\", error);\n  } else\n    evaluatedRes = Immutable.fromJS(newSequence).merge({evaluated: evaluated, evaluatedDetails: details, evaluatedError:error, error:error});\n    // console.log(\"evalSequences result\", evaluatedRes.toJS());\n    return evaluatedRes;\n}\n\nvar processedAndReEval = new Bacon.Bus();\n\nprocessedAndReEval.plug(processed);\n\n\nvar markForReEval = function(loadedSequences, device) {\n  loadedSequences.entrySeq().forEach((s) => {\n    var [seqName, seq]=s;\n    if (seq.get(\"imports\").get(device)) {\n      console.log(\"marking \".bgMagenta, (\"\"+seqName).underline,\"for reEvaluation\");\n      processedAndReEval.push(seq.toJS());\n      markForReEval(loadedSequences, seq.get(\"device\"));\n    }\n  });\n}\n\nexport var evaluated =\n  Bacon.zipAsArray(loadedSequenceStream, processedAndReEval).map(s => {\n    var res = evalStreamEntry(...s);\n    var loadedSequences = s[0];\n    var newSequence = s[1];\n    // if (!res.get(\"evaluatedError\"))\n    markForReEval(loadedSequences, newSequence.device);\n    return res;\n  });\n\nvar stackTrace = require('stack-trace');\n\nvar evaluatedSequenceStream = evaluated.scan(\n  Immutable.Map(), (prev, next) => prev.set(next.get(\"device\"), next)\n);\n\n// evaluatedSequenceStream.onValue(v => console.log(\"evaluated\".bold.underline, v.valueSeq().map(v=>v.get(\"evaluatedDetails\")).toJS()));\n\n\nloadedSequenceStream.plug(evaluatedSequenceStream);\n\nexport var loadedSequences = evaluatedSequenceStream;\n\n\nvar processedSequences_noStack = evaluated//.filter((n) => n.get(\"evaluated\"))//.flatMap((n) => n.get(\"evaluated\").toJS());\n.flatMap(n => {\n  if (!n.toJS)\n  console.log(\"nnn\",n);\n var n = n.toJS();\n // console.log(\"flatMap\",Object.keys(n.evaluated).map(seqName => ({device: n.device, name:seqName})));\n return Bacon.fromArray(n.exports.map(seqName => _.extend({sequence: n.evaluated ? n.evaluated[seqName] : null, device: n.device, name:seqName},n)));\n});\n\n\nexport var processedSequences = processedSequences_noStack.map((s) => {\n  var error = s.error || s.evaluatedError;\n  if (error && error instanceof Error) {\n    console.log(\"generating stacktrace for error\", error);\n    s.error = error;\n    s.error.stackTrace = stackTrace.parse(error);\n  }\n  return s;\n}\n);\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","$traceurRuntime.spread($__placeholder__0)","$__placeholder__0[$traceurRuntime.toProperty($__placeholder__1)]"]}