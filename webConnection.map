{"version":3,"file":"app-build/webConnection.js","sources":["app/webConnection.js","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/10"],"names":[],"mappings":"AAmBA;ACnBA,KAAK,iBAAiB,AAAC,CAAC,OAAM;SCA9B,EAAC,GAAE,YCAqB;AAAE,uBAAwB;IAAE,ADA9B,CAAC;AEAvB,WAAS,CCAT,EAAC,KAAI,CDAO,KAAG,ACAS,CAAC;CJAyB,CAAC;;ADmBnD,AAAI,EAAA,CAAA,GAAE,EAAI,CAAA,OAAM,AAAC,CAAC,eAAc,CAAC,CAAC;AAElC,AAAI,EAAA,CAAA,CAAA,EAAI,CAAA,OAAM,AAAC,CAAC,QAAO,CAAC,CAAC;AAEzB,MAAM,IAAI,AAAC,CAAC,wBAAuB,CAAC,CAAC;AAUrC,AAAI,EAAA,CAAA,EAAC,EAAI,CAAA,GAAE,GAAG,CAAC;EAIP,UAAQ,EMrChB,EAAC,gBAAoB,CAAA,OAAM,AAAC,eAAkB,CACtC,CAAA,iBAAqB,0BAA2B,CAAA,iBAAqB,GAAK,EAAC,OAAM,gBAAmB,CAD9D,AAC+D,CAAC;ANsC9G,AAAI,EAAA,CAAA,cAAa,EAAI,GAAC,CAAC;AAEvB,AAAI,EAAA,CAAA,KAAI,EAAI,CAAA,OAAM,AAAC,CAAC,SAAQ,CAAC,CAAC;AAE9B,AAAI,EAAA,CAAA,WAAU,EAAI,CAAA,KAAI,WAAW,AAAC,CAAC,SAAS,IAAG,CAAG;AAEhD,GAAC,GAAG,AAAC,CAAC,YAAW,CAAG,UAAS,MAAK,CAAE;AAClC,AAAI,MAAA,CAAA,QAAO,EAAI,KAAG,CAAC;AACnB,UAAM,IAAI,AAAC,CAAC,oBAAmB,CAAC,CAAC;AACjC,cAAU,AAAC,CAAC,SAAQ,AAAC,CAAE;AACrB,WAAK,KAAK,AAAC,CAAC,MAAK,CAAE,OAAK,CAAC,CAAC;IAC5B,CAAG,MAAI,CAAC,CAAA;AACR,SAAK,GAAG,AAAC,CAAC,mBAAkB,CAAG,UAAQ,AAAC,CAAE;AACxC,YAAM,IAAI,AAAC,CAAC,mBAAkB,CAAC,CAAC;AAGhC,SAAI,cAAa,CAAG;AAClB,aAAK,KAAK,AAAC,CAAC,cAAa,CAAC,QAAQ,AAAC,CAAC,SAAS,OAAM,CAAG;AACpD,gBAAM,IAAI,AAAC,CAAC,WAAU,CAAE,QAAM,CAAC,CAAC;AAChC,WAAC,QAAQ,KAAK,AAAC,CAAC,iBAAgB,CAAE,CAAA,cAAa,CAAE,OAAM,CAAC,CAAC,CAAC;QAC5D,CAAC,CAAC;MACJ;AAAA,IACF,CAAC,CAAC;AAEF,SAAK,GAAG,AAAC,CAAC,SAAQ,CAAG,UAAS,GAAE,CAAE;AAChC,YAAM,IAAI,AAAC,CAAC,mBAAkB,CAAG,IAAE,CAAC,CAAC;AACrC,aAAO,EAAI,CAAA,GAAE,OAAO,CAAC;AACrB,AAAI,QAAA,CAAA,GAAE,EAAE,CAAA,SAAQ,IAAI,AAAC,CAAC,QAAO,CAAC,CAAC;AAC/B,YAAM,IAAI,AAAC,CAAC,cAAa,CAAE,IAAE,CAAC,CAAC;AAC/B,WAAK,KAAK,AAAC,CAAC,MAAK,CAAE,IAAE,CAAC,CAAC;IACzB,CAAC,CAAC;AAWF,SAAK,GAAG,AAAC,CAAC,YAAW,CAAG,UAAS,GAAE,CAAE;AACnC,YAAM,IAAI,AAAC,CAAC,WAAU,CAAG,IAAE,CAAC,CAAC;AAC7B,SAAG,AAAC,CAAC;AAAC,aAAK,CAAE,CAAA,GAAE,OAAO;AAAG,WAAG,CAAE,CAAA,GAAE,KAAK;AAAA,MAAC,CAAC,CAAC;IAC1C,CAAC,CAAC;EACJ,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,MAAM,IAAI,AAAC,CAAC,WAAU,CAAE,YAAU,CAAC,CAAC;AAMpC,AAAI,EAAA,CAAA,eAAc,EAAI,UAAS,AAAc,CAAG;IAAjB,WAAS,6CAAE,KAAG;AAO7C,CAAA;AAGA,AAAI,EAAA,CAAA,mBAAkB,EAAI,UAAS,OAAM,CAAG;AAC1C,eAAa,CAAE,OAAM,IAAI,AAAC,CAAC,QAAO,CAAC,CAAC,EAAI,CAAA,OAAM,KAAK,AAAC,EAAC,CAAC;AACtD,GAAC,QAAQ,KAAK,AAAC,CAAC,iBAAgB,CAAE,CAAA,OAAM,KAAK,AAAC,EAAC,CAAC,CAAC;AACnD,CAAA;AAGA,AAAI,EAAA,CAAA,YAAW,EAAI,UAAS,QAAO;AAEjC,SAAO,SAAS,AAAC,CAAC,GAAE,CAAC,QAAQ,AAAC,EAAC,SAAC,CAAA,CAAM;AACpC,KAAC,KAAK,AAAC,CAAC,MAAK,CAAE,EAAA,CAAC,CAAA;EAChB,EAAC,CAAC;AACN,CAAA;AAGA,AAAI,EAAA,CAAA,YAAW,EAAI,IAAI,CAAA,KAAI,IAAI,AAAC,EAAC,CAAC;AAElC,WAAW,QAAQ,AAAC,EAAC,SAAC,CAAA,CAAM;AAC1B,GAAC,QAAQ,KAAK,AAAC,CAAC,gBAAe,CAAE,EAAA,CAAC,CAAC;AACrC,EAAC,CAAA;AAED,AAAI,EAAA,CAAA,KAAI,EAAE,EAAA,CAAC;AACX,AAAI,EAAA,CAAA,gBAAe,EAAI,IAAI,CAAA,KAAI,IAAI,AAAC,EAAC,CAAC;AACtC,eAAe,OAAO,AAAC,EAAC,SAAC,CAAA;OAAM,CAAA,CAAA,KAAK,GAAG,SAAO,CAAA,EAAK,EAAC,CAAA,cAAc;AAAA,EAAC,eAAe,AAAC,CAAC,CAAA,QAAQ,CAAC,QAAQ,AAAC,EAAC,SAAC,CAAA,CAAM;AAC5G,QAAM,IAAI,AAAC,CAAC,CAAA,CAAC,CAAC;AAEd,GAAC,QAAQ,KAAK,AAAC,CAAC,eAAc,CAAE;AAAC,QAAI,CAAE,CAAA,KAAI,EAAE;AAAG,SAAK,CAAE,CAAA,CAAA,OAAO;AAAG,QAAI,CAAE,CAAA,CAAA,MAAM;AAAG,OAAG,CAAE,CAAA,CAAA,KAAK;AAAG,OAAG,CAAE,CAAA,CAAA,KAAK;AAAE,UAAM,CAAE,CAAA,CAAA,QAAQ;AAAG,WAAO,CAAE,CAAA,CAAA,SAAS;AAAG,gBAAY,CAAG,CAAA,CAAA,cAAc;AAAA,EAAC,CAAC,CAAC;AACnL,EAAC,CAAA;AOjID,AAAI,EAAA,CAAA,UAAS,EPmIE;AAAC,SAAO,CAAG,YAAU;AAAG,gBAAc,CAAG,gBAAc;AAAG,aAAW,CAAE,aAAW;AAAG,aAAW,CAAX,aAAW;AAAG,iBAAe,CAAf,iBAAe;AAAG,0BAAwB,CAAE,oBAAkB;AOnI/I,APmI+I,AAAC,COnIhJ;APqIjC,MAAM,IAAI,AAAC,CAAC,UAAS,CAAC,CAAC;AACvB","sourceRoot":"app-build/","sourcesContent":["//var traceur = require(\"traceur\");\n//\n// console.log(traceur);\n\n//var socket = require( 'koa-socket' );\n\n\n\n// $ GET /package.json\n//app.use(serve('.'));\n\n\n\n// $ GET /hello.txt\n//app.use(serve('./browser-build'));\n\n// or use absolute paths\n//app.use(serve(__dirname + '/test/fixtures'));\n\nvar srv = require(\"../web/server\");\n\nvar _ = require(\"lodash\");\n\nconsole.log('listening on port 8000');\n\n// socket.start(app);\n//\n// socket.on('join', function(data){\n//   console.log(\"client connect\");\n//   console.log( 'join event fired', data );\n// });\n\n\nvar io = srv.io;\n\n// console.log(io);\n\nimport {codeStore} from \"./codeStore\";\n\nvar generatorStore = {};\n\nvar Bacon = require(\"baconjs\");\n\nvar baconStream = Bacon.fromBinder(function(sink) {\n\n  io.on('connection', function(socket){\n    var deviceId = null;\n    console.log('a device connected');\n    setInterval(function() {\n      socket.emit(\"ping\",\"ping\");\n    }, 30000)\n    socket.on(\"requestGenerators\", function() {\n      console.log(\"requestGenerators\");\n\n      // console.log(\"requestGenerators\", generatorStore);\n      if (generatorStore) {\n        Object.keys(generatorStore).forEach(function(devName) {\n          console.log(\"emitting \",devName);\n          io.sockets.emit(\"generatorUpdate\",generatorStore[devName]);\n        });\n      }\n    });\n\n    socket.on('getCode', function(msg){\n      console.log('getCode message: ', msg);\n      deviceId = msg.device;\n      var res=codeStore.get(deviceId);\n      console.log(\"sending code\",res);\n      socket.emit(\"code\",res);\n    });\n\n    // socket.on('getDevices', function(msg){\n    //   console.log('getDevices message: ', msg);\n    //   var res=codeStore.get(deviceId);\n    //   console.log(\"sending code\",res);\n    //   socket.emit(\"code\",res);\n    //\n    // });\n\n    //socket.emit(\"code\", \"something is going on\\n is going on!!\");\n    socket.on('codeChange', function(msg){\n      console.log('message: ', msg);\n      sink({device:msg.device, code:msg.code});\n    });\n  });\n});\n\nconsole.log(\"exporting\",baconStream);\n\n// baconStream.onValue(function(v) {\n//   console.log(\"baconVal\",v);\n// });\n\nvar generatorUpdate = function(generators=null) {\n  // if (generators != null)\n  //   generatorStore = generators;\n  // console.log(\"emitting generators\", generatorStore);\n  // console.log(io.emit);\n  // io.sockets.emit(\"generators\", generatorStore);\n  // console.log(\"emitted\");\n}\n\n\nvar individualGenUpdate = function(genData) {\n  generatorStore[genData.get(\"device\")] = genData.toJS();\n  io.sockets.emit(\"generatorUpdate\",genData.toJS());\n}\n\n\nvar beatFeedback = function(beatInfo) {\n\n  beatInfo.throttle(100).onValue((v) => {\n    io.emit(\"beat\",v)\n    });\n}\n\n\nvar remoteLogger = new Bacon.Bus();\n\nremoteLogger.onValue((v) => {\n  io.sockets.emit(\"consoleMessage\",v);\n})\n\nvar count=0;\nvar sequenceFeedback = new Bacon.Bus();\nsequenceFeedback.filter((v) => v.type==\"noteOn\" && !v.automationVal).skipDuplicates(_.isEqual).onValue((v) => {\n  console.log(v);\n\n  io.sockets.emit(\"sequenceEvent\",{count:count++, device:v.device, pitch:v.pitch, time:v.time, name:v.name,seqName:v.seqName, velocity:v.velocity, automationVal: v.automationVal});\n})\n\nexport default {liveCode: baconStream, generatorUpdate: generatorUpdate, beatFeedback:beatFeedback, remoteLogger, sequenceFeedback, individualGeneratorUpdate:individualGenUpdate};\n\nconsole.log(\"exported\");\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__default = $__placeholder__0"]}