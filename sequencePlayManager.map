{"version":3,"file":"app-build/sequencePlayManager.js","sources":["app/sequencePlayManager.js","@traceur/generated/TemplateParser/5","@traceur/generated/TemplateParser/3","@traceur/generated/TemplateParser/0","@traceur/generated/TemplateParser/1","@traceur/generated/TemplateParser/4","@traceur/generated/TemplateParser/6","@traceur/generated/TemplateParser/10","@traceur/generated/TemplateParser/9","@traceur/generated/TemplateParser/7"],"names":[],"mappings":"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","sourceRoot":"app-build/","sourcesContent":["\nvar Bacon = require(\"baconjs\");\nimport {BaconSequencer} from \"./tomSequencer\";\nvar _ = require(\"lodash\");\n\nimport {abletonReceiver, abletonSender} from \"./oscAbleton\";\nvar sequenceSubscribe = abletonReceiver.sequencePlayRequests;\nexport default function(time, resetMessages, sequenceFeedback) {\n  //console.log(sequenceSubscribe);\n  // sequenceSubscribe.log(\"seqSubsribe\");\n\n  var newSequenceBus = new Bacon.Bus();\n\n  var resetRequests = new Bacon.Bus();\n\n\n  var availableSequences = {};\n\n  var playSequencer = (sequencer,inst, name) => sequencer.onValue((playFunc) => {\n    // console.log(\"sending seqName\",name);\n    sequenceFeedback.push(_.extend({seqName: name}, playFunc.evt))  ;\n    playFunc.play(inst);\n  });\n  var playingSequences = {};\n\n  var Sequencer = BaconSequencer(time);\n\n  var subscribedSequences = [];\n\n  function playOnlySubscribed() {\n    console.log(\"subscribedSequences\",subscribedSequences);\n    var needToBeStopped = _.without(Object.keys(playingSequences), ..._.pluck(subscribedSequences,\"sequenceName\"));\n    for (let seqName of needToBeStopped) {\n      playingSequences[seqName].stop();\n      delete playingSequences[seqName];\n    }\n    var needToPlay = _.without(_.pluck(subscribedSequences,\"sequenceName\"),...Object.keys(playingSequences));\n    console.log(\"availableSequences\",availableSequences);\n    console.log(\"needToPlay\",needToPlay);\n    for (let seqName of needToPlay) {\n      if (availableSequences[seqName])\n        instrumentPlayer(availableSequences[seqName]);\n    }\n    resetRequests.push(Math.random());\n  }\n\n  sequenceSubscribe.onValue((sub) => {\n    if (!availableSequences[sub.sequenceName]){\n      // console.warn(\"tried subscribing to \"+sub.sequenceName+\" but not available\");\n      return;\n    }\n    console.log(\"subscribing\",sub.sequenceName);//, \"subscribed\", subscribedSequences);\n    if (_.find(subscribedSequences, (s) => s.port == sub.port && s.sequenceName == sub.sequenceName))\n      return;\n\n    _.remove(subscribedSequences, (s) => s.port == sub.port);\n    subscribedSequences.push(sub);\n    playOnlySubscribed();\n  });\n\n  var instrumentPlayer = function(seq) {\n\n    var port = _.find(subscribedSequences,(s) => s.sequenceName == seq.name).port;\n    console.log(\"creating instrument for\",seq.name,port);\n    var seqInst = abletonSender.subscribeInstrument(seq.name,port);\n    playingSequences[seq.name] = {stop: playSequencer(Sequencer(seq.sequence,seq.name),seqInst, seq.name), sequence: seq.sequence, name:seq.name, port: port};\n  }\n\n  resetMessages.onValue(() => {\n     for (let seqName of Object.keys(playingSequences)) {\n       playingSequences[seqName].stop();\n       console.log(\"after reset recreating instrumentPlayer for \",seqName,playingSequences[seqName]);\n       instrumentPlayer(playingSequences[seqName]);\n       //playingSequences[seqName] = {stop: playSequencer(Sequencer(seq.sequence,seq.name),seqInst), sequence: seq.sequence};\n     }\n  });\n\n  newSequenceBus.onValue((seq) => {\n    availableSequences[seq.name] = seq;\n    if (playingSequences[seq.name]) {\n      playingSequences[seq.name].stop();\n      instrumentPlayer(seq);\n    }\n  });\n\n  return {playingSequences: playingSequences, availableSequences: availableSequences, newSequence: newSequenceBus, resetRequests:resetRequests}\n}\n","Object.defineProperties(exports, $__placeholder__0);","{get: $__placeholder__0}","get $__placeholder__0() { return $__placeholder__1; }","__esModule: true","{value: $__placeholder__0}","($__placeholder__0 = require($__placeholder__1),\n        $__placeholder__2 && $__placeholder__3.__esModule && $__placeholder__4 || {default: $__placeholder__5})","var $__default = $__placeholder__0","$traceurRuntime.spread($__placeholder__0)","\n        for (var $__placeholder__0 =\n                 $__placeholder__1[\n                     $traceurRuntime.toProperty(Symbol.iterator)](),\n                 $__placeholder__2;\n             !($__placeholder__3 = $__placeholder__4.next()).done; ) {\n          $__placeholder__5;\n          $__placeholder__6;\n        }"]}